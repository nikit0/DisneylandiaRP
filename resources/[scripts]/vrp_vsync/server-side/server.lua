-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp", "lib/Tunnel")
local Proxy = module("vrp", "lib/Proxy")
vRP = Proxy.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONEXÃƒO
-----------------------------------------------------------------------------------------------------------------------------------------
vRPclient = Tunnel.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local hours = 09
local minutes = 00
local weather = 0
-----------------------------------------------------------------------------------------------------------------------------------------
-- TIMERS
-----------------------------------------------------------------------------------------------------------------------------------------
local timers = {
	[1] = { "EXTRASUNNY", 240 },
	[2] = { "RAIN", 12 },
	[3] = { "THUNDER", 3 },
	[4] = { "CLEAR", 240 },
	[5] = { "SNOW", 2 },
	[6] = { "BLIZZARD", 1 },
	[7] = { "XMAS", 10 },
	[8] = { "SNOW", 2 },
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- /clima
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterCommand("weather", function(source, args, rawCommand)
	local user_id = vRP.getUserId(source)
	if user_id then
		if vRP.hasPermission(user_id, "admin.permissao") then
			weather = args[1]
			TriggerClientEvent("vrp_vsync:updateWeather", -1, weather)
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- /tempo
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterCommand("time", function(source, args, rawCommand)
	local user_id = vRP.getUserId(source)
	if user_id then
		if vRP.hasPermission(user_id, "admin.permissao") then
			hours = parseInt(args[1])
			minutes = parseInt(args[2])
			TriggerClientEvent("vrp_vsync:syncTimers", -1, { minutes, hours })
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- REQUESTSYNC
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterServerEvent("vrp_vsync:requestSync")
AddEventHandler("vrp_vsync:requestSync", function()
	TriggerClientEvent("vrp_vsync:updateWeather", -1, timers[weather][1])
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- UPDATECLOCK
-----------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
	while true do
		Wait(2000)
		minutes = minutes + 1
		if minutes >= 60 then
			minutes = 0
			hours = hours + 1
			if hours >= 24 then
				hours = 0
			end
		end
		TriggerClientEvent("vrp_vsync:syncTimers", -1, { minutes, hours })
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- UPDATEWEATHER
-----------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
	while true do
		weather = weather + 1
		if weather > #timers then
			weather = 1
		end
		TriggerClientEvent("vrp_vsync:updateWeather", -1, timers[weather][1])
		Wait(timers[weather][2] * 60000)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- /snowball
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterCommand("snowball", function(source, args, rawCommand)
	if vRPclient.getHealth(source) <= 101 or vRPclient.isInVehicle(source) or vRPclient.isHandcuffed(source) then
		return
	end
	TriggerClientEvent("snowball", source)
end)
